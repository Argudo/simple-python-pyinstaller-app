version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - python --version
            - python -m py_compile sources/add2vals.py sources/calc.py
      prologue:
        commands:
          - checkout
    dependencies: []
  - name: Test
    dependencies:
      - Build
    task:
      epilogue:
        on_pass:
          commands:
            - junit 'test-reports/results.xml
      jobs:
        - name: 'Job #1'
          commands:
            - py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py
      prologue:
        commands:
          - pip install pytest
  - name: Deliver
    dependencies:
      - Test
    task:
      epilogue:
        on_pass:
          commands:
            - archiveArtifacts 'dist/add2vals'
      jobs:
        - name: 'Job #1'
          commands:
            - pyinstaller --onefile sources/add2vals.py
